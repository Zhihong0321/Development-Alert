<!DOCTYPE html>
<html>
<head>
  <title>Simple Deployment Alert</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .log { background: #f5f5f5; padding: 10px; height: 300px; overflow-y: auto; margin: 20px 0; }
    button { padding: 10px 20px; margin: 5px; }
  </style>
</head>
<body>
  <h1>üö® Simple Deployment Alert</h1>
  
  <button onclick="testSound()">Test Sound</button>
  <button onclick="sendTest()">Send Test Notification</button>
  
  <div class="log" id="log">Waiting for notifications...</div>
  
  <script>
    // Simple sound function
    function playSound(event) {
      console.log('üîä Playing sound for:', event);
      
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      // Different frequencies for different events
      const frequencies = {
        deployment_success: 800,
        build_success: 600,
        build_failure: 300,
        deployment_failure: 400
      };
      
      oscillator.frequency.setValueAtTime(frequencies[event] || 500, audioContext.currentTime);
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
    }
    
    function testSound() {
      playSound('deployment_success');
    }
    
    function sendTest() {
      fetch('/notify?project=test&event=deployment_success&message=Test notification')
        .then(res => res.json())
        .then(data => console.log('Test sent:', data));
    }
    
    function addLog(message) {
      const log = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      log.innerHTML += `<div>[${time}] ${message}</div>`;
      log.scrollTop = log.scrollHeight;
    }
    
    // Connect to notifications
    const eventSource = new EventSource('/events');
    
    eventSource.onmessage = function(event) {
      const data = JSON.parse(event.data);
      console.log('üì® Notification received:', data);
      
      addLog(`üö® ${data.project}: ${data.event} - ${data.message}`);
      
      // PLAY SOUND HERE - This is the key part!
      playSound(data.event);
    };
    
    eventSource.onopen = function() {
      console.log('‚úÖ Connected to notifications');
      addLog('‚úÖ Connected to notification stream');
    };
    
    eventSource.onerror = function() {
      console.log('‚ùå Connection error');
      addLog('‚ùå Connection error');
    };
    
    // Initialize audio on first click
    document.addEventListener('click', function() {
      console.log('üéµ Audio initialized');
    }, { once: true });
  </script>
</body>
</html>